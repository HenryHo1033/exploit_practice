import os
import smtplib
from configparser import ConfigParser
from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.header import Header

class Common():
    @classmethod
    def work_dir(self):

        work_dir = os.path.dirname(os.path.abspath(__file__))
        front_dir = os.path.dirname(work_dir)

        return front_dir

class ConfLoader():

    def __init__(self):
        self.__common = Common()
        self.__front_dir = self.__common.work_dir()
        self.__conf = ConfigParser()
        self.__conf.read(f'{self.__front_dir}/conf/conf.ini')

    def conf_info(self, feature, column):
        return self.__conf[feature][column]

class SMTP():

    CL = ConfLoader()
    SMTP_SERVER = CL.conf_info("smtp_conf","server")
    SMTP_PORT = CL.conf_info("smtp_conf","port")
    SMTP_ACCOUNT = CL.conf_info("smtp_conf","account")
    SMTP_PASSWORD = CL.conf_info("smtp_conf","password")
    SMTP_CLIENT = CL.conf_info("smtp_conf","client_email")


    def __init__(self):

        self.smtp = smtplib.SMTP_SSL(SMTP.SMTP_SERVER, SMTP.SMTP_PORT)


    def msg_context(self, subject, body):

        msg = MIMEMultipart()
        msg["From"] = Header(SMTP.SMTP_ACCOUNT)
        msg["To"] = Header(SMTP.SMTP_ACCOUNT)
        msg["Subject"] = Header(subject)
        msg.attach(MIMEText(body, 'html'))

        return msg