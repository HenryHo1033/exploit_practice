import pymysql
from app.classes.common import *

class Mysql():

    def __init__(self):

        self.__conf_loader = ConfLoader()
        self.__db = pymysql.connect(host = self.__conf_loader.conf_info('db_conf','host'),
                                    port = int(self.__conf_loader.conf_info('db_conf','port')),
                                    database=self.__conf_loader.conf_info('db_conf', 'db'),
                                    user = self.__conf_loader.conf_info('db_user','name'),
                                    password = self.__conf_loader.conf_info('db_user','passwd')
                                    )

        self.__cursor = self.__db.cursor()

    @property
    def cursor(self):

        return self.__cursor

    def search(self, sql):

        try:
            self.__cursor.execute(sql)

        except:
            raise Exception

        return self.__cursor.fetchall()

    def close(self):

        if self.__db:
            self.__db.close()

        if self.__cursor:
            self.__cursor.close()

    def insert(self, sql):

        self.__cursor.execute(sql)
        self.__db.commit()