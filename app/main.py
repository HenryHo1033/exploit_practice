from flask import Flask,render_template,request,redirect,url_for,make_response
from app.service.signin import Signin
from app.service.userInfo import User

app = Flask(__name__)

@app.route('/')
def index():

    return render_template('index.html')

@app.route('/home', methods = ['GET'])
def home():


    if 'user_id' not in request.cookies:

        return redirect(url_for('signin'))

    else:
        user = User()
        user_data = user.user_info(request.cookies['user_id'])

        print (user_data)

        user_info = {}
        user_info['user_name'] = request.cookies['user_name']

        return render_template('userInfo.html', user_info = user_info)


@app.route('/signin')
def signin():

    return render_template('signin.html')


@app.route('/signinSubmit', methods = ['POST'])
def signin_submit():
    signin = Signin()


    if signin.signin(form = request.form):

        user_data = signin.user_data

        response = make_response(redirect(url_for('home')))
        response.set_cookie("user_id", str(user_data['user_id']))
        response.set_cookie("user_name", user_data['user_name'])


        return response

    else:

        return redirect(url_for('signin'))



if __name__ == "__main__":
    app.run(debug = True)